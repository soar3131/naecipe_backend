# Implementation Plan: 레시피북 기본 CRUD

**Branch**: `007-cookbook-basic-crud` | **Date**: 2025-12-11 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/007-cookbook-basic-crud/spec.md`

## Summary

레시피북(Cookbook) CRUD 기능을 구현합니다. 사용자는 레시피를 분류하고 관리하기 위해 레시피북을 생성, 조회, 수정, 삭제, 순서 변경할 수 있습니다. 첫 접근 시 "내 레시피북"이 자동으로 생성되며, 기본 레시피북은 삭제할 수 없습니다.

**핵심 기술 결정**:
- 기본 레시피북: Lazy Creation (첫 접근 시 자동 생성)
- 저장된 레시피 수: 서브쿼리 COUNT (실시간 정확성)
- 기본 레시피북 단일성: PostgreSQL Partial Unique Index
- 순서 변경: 1부터 재할당 방식

## Technical Context

**Language/Version**: Python 3.11+
**Primary Dependencies**: FastAPI 0.100+, SQLAlchemy 2.0+, Pydantic 2.0+
**Storage**: PostgreSQL 15+ (단일 DB, cookbooks 스키마)
**Cache**: Redis 7+ (필요시)
**Testing**: pytest, pytest-asyncio, httpx
**Target Platform**: Linux (AWS ECS Fargate)
**Project Type**: Modular Monolith (app/ 기반 도메인 모듈)
**Performance Goals**: CRUD API 응답 < 200ms (p99)
**Constraints**: 사용자당 레시피북 최대 50개 권장 (soft limit)
**Scale/Scope**: app/cookbooks/ 모듈, 6개 API 엔드포인트

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

Constitution 원칙 준수 여부를 확인합니다 (`.specify/memory/constitution.md` 참조):

| 원칙 | 검증 항목 | 상태 |
|------|----------|------|
| I. API-First | OpenAPI 스펙 정의됨? | ✅ `contracts/cookbooks-api.yaml` |
| II. Modular Monolith | 도메인 경계 명확함? `app/cookbooks/` 배치? | ✅ cookbooks 모듈 독립 |
| III. TDD | Contract/Integration 테스트 계획됨? | ✅ tests/cookbooks/ 계획 |
| IV. Async Task | BackgroundTasks 필요? | ⬜ 해당 없음 (동기 CRUD) |
| V. Security | OWASP 대응, 입력 검증 계획됨? | ✅ Pydantic 검증, 권한 체크 |
| VI. Observability | 로깅/메트릭/추적 계획됨? | ✅ 구조화 로깅 포함 |
| VII. Simplicity | 불필요한 추상화 없음? | ✅ 직접 서비스 레이어 |

## Project Structure

### Documentation (this feature)

```text
specs/007-cookbook-basic-crud/
├── spec.md              # 기능 명세 ✅
├── plan.md              # This file ✅
├── research.md          # 기술 결정 ✅
├── data-model.md        # 엔티티 스키마 ✅
├── quickstart.md        # 통합 시나리오 ✅
├── contracts/           # OpenAPI 명세 ✅
│   └── cookbooks-api.yaml
└── tasks.md             # /speckit.tasks 명령으로 생성 예정
```

### Source Code (repository root)

```text
app/
├── cookbooks/              # 레시피북 도메인 모듈 (구현 대상)
│   ├── __init__.py        # 모듈 초기화
│   ├── models.py          # Cookbook SQLAlchemy 모델
│   ├── schemas.py         # Pydantic 스키마
│   ├── services.py        # CookbookService 비즈니스 로직
│   └── router.py          # FastAPI 라우터

tests/
├── cookbooks/             # 레시피북 테스트
│   ├── conftest.py        # 테스트 픽스처
│   ├── test_cookbook_crud.py   # API 통합 테스트
│   └── test_cookbook_service.py # 서비스 단위 테스트

alembic/
└── versions/
    └── xxx_create_cookbooks_table.py  # 마이그레이션
```

## Implementation Approach

### Phase 1: Setup (기반 구조)

1. Alembic 마이그레이션 생성 (cookbooks 테이블)
2. Cookbook 모델 정의 (`app/cookbooks/models.py`)
3. Pydantic 스키마 정의 (`app/cookbooks/schemas.py`)
4. 테스트 픽스처 설정 (`tests/cookbooks/conftest.py`)

### Phase 2: User Story 1 & 2 (P1 - MVP)

1. CookbookService 기본 구조 생성
2. `ensure_default_cookbook()` 구현 (기본 레시피북 자동 생성)
3. `create_cookbook()` 구현
4. `get_cookbooks()` 구현 (목록 조회 + saved_recipe_count)
5. FastAPI 라우터 연결 (`POST /cookbooks`, `GET /cookbooks`)
6. 통합 테스트 작성

### Phase 3: User Story 3 & 4 (P2)

1. `get_cookbook_by_id()` 구현 (상세 조회)
2. `update_cookbook()` 구현 (수정)
3. FastAPI 라우터 연결 (`GET /cookbooks/{id}`, `PUT /cookbooks/{id}`)
4. 통합 테스트 작성

### Phase 4: User Story 5 & 6 (P3)

1. `delete_cookbook()` 구현 (삭제, 기본 레시피북 차단)
2. `reorder_cookbooks()` 구현 (순서 변경)
3. FastAPI 라우터 연결 (`DELETE /cookbooks/{id}`, `PATCH /cookbooks/reorder`)
4. 통합 테스트 작성

### Phase 5: Polish

1. 에러 핸들링 개선 (커스텀 예외)
2. 구조화된 로깅 추가
3. OpenAPI 문서 검증
4. 성능 테스트 (응답 시간 200ms 이내)

## Dependencies

### 선행 스펙

- ✅ SPEC-001 (사용자 인증): JWT 토큰 기반 인증, `get_current_user` 의존성

### 후행 스펙

- SPEC-008 (레시피 저장하기): SavedRecipe 테이블 상세 구현, cookbook_id 외래키 사용

### 기술 의존성

| 패키지 | 용도 | 버전 |
|--------|------|------|
| fastapi | API 프레임워크 | 0.100+ |
| sqlalchemy | ORM | 2.0+ |
| pydantic | 스키마 검증 | 2.0+ |
| pytest-asyncio | 비동기 테스트 | 0.21+ |
| httpx | 테스트 클라이언트 | 0.24+ |

## Complexity Tracking

Constitution Check 위반 사항 없음. 추가 정당화 불필요.

## Next Steps

1. `/speckit.tasks` 실행하여 tasks.md 생성
2. 각 태스크 순서대로 구현
3. 구현 완료 후 커밋

---

**Generated by**: `/speckit.plan`
**Date**: 2025-12-11
