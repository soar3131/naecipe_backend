openapi: 3.0.3
info:
  title: Naecipe User Authentication API
  description: 사용자 인증 API (회원가입, 로그인, 토큰 갱신, 로그아웃)
  version: 1.0.0
  contact:
    name: Naecipe Backend Team

servers:
  - url: http://localhost:8002/v1
    description: Local Development
  - url: https://api.naecipe.com/v1
    description: Production

tags:
  - name: auth
    description: 인증 관련 API

paths:
  /auth/register:
    post:
      tags:
        - auth
      summary: 회원가입
      description: 이메일과 비밀번호로 새로운 사용자 계정을 생성합니다.
      operationId: registerUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
            example:
              email: user@example.com
              password: SecurePass123
      responses:
        '201':
          description: 회원가입 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RegisterResponse'
        '400':
          description: 잘못된 요청 (이메일 형식 오류, 비밀번호 정책 위반)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetail'
              example:
                type: https://api.naecipe.com/errors/validation
                title: Validation Error
                status: 400
                detail: 비밀번호는 최소 8자 이상이어야 합니다.
                instance: /v1/auth/register
        '409':
          description: 이메일 중복
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetail'
              example:
                type: https://api.naecipe.com/errors/auth/email-exists
                title: Email Already Exists
                status: 409
                detail: 이미 등록된 이메일 주소입니다.
                instance: /v1/auth/register

  /auth/login:
    post:
      tags:
        - auth
      summary: 로그인
      description: 이메일과 비밀번호로 로그인하여 Access Token과 Refresh Token을 발급받습니다.
      operationId: loginUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            example:
              email: user@example.com
              password: SecurePass123
      responses:
        '200':
          description: 로그인 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
        '401':
          description: 인증 실패 (잘못된 이메일 또는 비밀번호)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetail'
              example:
                type: https://api.naecipe.com/errors/auth/invalid-credentials
                title: Authentication Failed
                status: 401
                detail: 이메일 또는 비밀번호가 올바르지 않습니다.
                instance: /v1/auth/login
        '423':
          description: 계정 잠금 (연속 로그인 실패)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetail'
              example:
                type: https://api.naecipe.com/errors/auth/account-locked
                title: Account Locked
                status: 423
                detail: 연속된 로그인 실패로 계정이 잠겼습니다. 15분 후 다시 시도해주세요.
                instance: /v1/auth/login

  /auth/logout:
    post:
      tags:
        - auth
      summary: 로그아웃
      description: 현재 세션을 종료하고 발급된 토큰을 무효화합니다.
      operationId: logoutUser
      security:
        - bearerAuth: []
      responses:
        '204':
          description: 로그아웃 성공 (응답 본문 없음)
        '401':
          description: 인증 필요 (유효하지 않은 토큰)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetail'

  /auth/refresh:
    post:
      tags:
        - auth
      summary: 토큰 갱신
      description: Refresh Token을 사용하여 새로운 Access Token과 Refresh Token을 발급받습니다.
      operationId: refreshToken
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshRequest'
            example:
              refresh_token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
      responses:
        '200':
          description: 토큰 갱신 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
        '401':
          description: 유효하지 않거나 만료된 Refresh Token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetail'
              example:
                type: https://api.naecipe.com/errors/auth/invalid-refresh-token
                title: Invalid Refresh Token
                status: 401
                detail: Refresh Token이 유효하지 않거나 만료되었습니다. 다시 로그인해주세요.
                instance: /v1/auth/refresh

  /auth/me:
    get:
      tags:
        - auth
      summary: 현재 사용자 정보
      description: 현재 로그인한 사용자의 기본 정보를 조회합니다.
      operationId: getCurrentUser
      security:
        - bearerAuth: []
      responses:
        '200':
          description: 사용자 정보 조회 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '401':
          description: 인증 필요
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetail'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT Access Token

  schemas:
    RegisterRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          maxLength: 255
          description: 사용자 이메일 주소
          example: user@example.com
        password:
          type: string
          format: password
          minLength: 8
          maxLength: 128
          description: 비밀번호 (최소 8자, 영문+숫자 포함)
          example: SecurePass123

    RegisterResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: 생성된 사용자 ID
          example: 550e8400-e29b-41d4-a716-446655440000
        email:
          type: string
          format: email
          description: 등록된 이메일 주소
          example: user@example.com
        created_at:
          type: string
          format: date-time
          description: 계정 생성 시각
          example: "2025-12-10T09:00:00Z"

    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          description: 사용자 이메일 주소
          example: user@example.com
        password:
          type: string
          format: password
          description: 비밀번호
          example: SecurePass123

    TokenResponse:
      type: object
      properties:
        access_token:
          type: string
          description: JWT Access Token (유효기간 15분)
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        refresh_token:
          type: string
          description: JWT Refresh Token (유효기간 7일)
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        token_type:
          type: string
          enum: [bearer]
          description: 토큰 타입
          example: bearer
        expires_in:
          type: integer
          description: Access Token 만료까지 남은 시간 (초)
          example: 900

    RefreshRequest:
      type: object
      required:
        - refresh_token
      properties:
        refresh_token:
          type: string
          description: Refresh Token
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

    UserResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: 사용자 ID
          example: 550e8400-e29b-41d4-a716-446655440000
        email:
          type: string
          format: email
          description: 이메일 주소
          example: user@example.com
        status:
          type: string
          enum: [active, inactive, locked]
          description: 계정 상태
          example: active
        created_at:
          type: string
          format: date-time
          description: 계정 생성 시각
          example: "2025-12-10T09:00:00Z"

    ProblemDetail:
      type: object
      description: RFC 7807 Problem Details 형식의 에러 응답
      properties:
        type:
          type: string
          format: uri
          description: 에러 타입을 식별하는 URI
          example: https://api.naecipe.com/errors/auth/invalid-credentials
        title:
          type: string
          description: 에러 타입에 대한 짧은 설명
          example: Authentication Failed
        status:
          type: integer
          description: HTTP 상태 코드
          example: 401
        detail:
          type: string
          description: 이 에러 발생에 대한 상세 설명 (사용자용)
          example: 이메일 또는 비밀번호가 올바르지 않습니다.
        instance:
          type: string
          description: 에러가 발생한 엔드포인트
          example: /v1/auth/login
