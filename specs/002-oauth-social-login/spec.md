# Feature Specification: OAuth 소셜 로그인

**Feature Branch**: `002-oauth-social-login`
**Created**: 2025-12-10
**Status**: Draft
**Input**: User description: "SPEC-002: OAuth 소셜 로그인 - Google, Kakao, Naver OAuth 연동"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 카카오 소셜 로그인 (Priority: P1)

사용자가 카카오 계정으로 간편하게 로그인하여 별도의 회원가입 절차 없이 서비스를 이용할 수 있다. 한국 사용자가 가장 많이 사용하는 소셜 로그인이므로 최우선으로 구현한다.

**Why this priority**: 한국 시장에서 카카오는 가장 높은 소셜 로그인 점유율을 가지므로, 사용자 온보딩 마찰을 최소화하기 위해 최우선 구현

**Independent Test**: 카카오 로그인 버튼 클릭 → 카카오 인증 → 앱으로 리다이렉트 → JWT 토큰 발급까지 독립적으로 테스트 가능

**Acceptance Scenarios**:

1. **Given** 카카오 계정이 있는 신규 사용자, **When** 카카오 로그인 버튼을 클릭하고 카카오 인증을 완료하면, **Then** 새 계정이 생성되고 JWT 토큰이 발급된다
2. **Given** 이미 카카오로 가입한 기존 사용자, **When** 카카오 로그인을 수행하면, **Then** 기존 계정으로 로그인되고 JWT 토큰이 발급된다
3. **Given** 카카오 인증 진행 중인 사용자, **When** 인증을 취소하면, **Then** 로그인이 중단되고 에러 메시지가 표시된다

---

### User Story 2 - 구글 소셜 로그인 (Priority: P1)

사용자가 구글 계정으로 로그인하여 글로벌 사용자들도 쉽게 서비스를 이용할 수 있다.

**Why this priority**: 글로벌 표준이자 안드로이드 사용자의 기본 계정으로, 카카오와 함께 핵심 로그인 옵션

**Independent Test**: 구글 로그인 버튼 클릭 → 구글 OAuth 인증 → 앱으로 리다이렉트 → JWT 토큰 발급까지 독립적으로 테스트 가능

**Acceptance Scenarios**:

1. **Given** 구글 계정이 있는 신규 사용자, **When** 구글 로그인 버튼을 클릭하고 구글 인증을 완료하면, **Then** 새 계정이 생성되고 JWT 토큰이 발급된다
2. **Given** 이미 구글로 가입한 기존 사용자, **When** 구글 로그인을 수행하면, **Then** 기존 계정으로 로그인되고 JWT 토큰이 발급된다

---

### User Story 3 - 네이버 소셜 로그인 (Priority: P2)

사용자가 네이버 계정으로 로그인하여 한국 사용자들에게 추가 로그인 옵션을 제공한다.

**Why this priority**: 한국 시장에서 카카오 다음으로 많이 사용되는 소셜 로그인, P1 이후 구현

**Independent Test**: 네이버 로그인 버튼 클릭 → 네이버 OAuth 인증 → 앱으로 리다이렉트 → JWT 토큰 발급까지 독립적으로 테스트 가능

**Acceptance Scenarios**:

1. **Given** 네이버 계정이 있는 신규 사용자, **When** 네이버 로그인 버튼을 클릭하고 네이버 인증을 완료하면, **Then** 새 계정이 생성되고 JWT 토큰이 발급된다
2. **Given** 이미 네이버로 가입한 기존 사용자, **When** 네이버 로그인을 수행하면, **Then** 기존 계정으로 로그인되고 JWT 토큰이 발급된다

---

### User Story 4 - 기존 이메일 계정과 소셜 계정 연동 (Priority: P2)

이미 이메일로 가입한 사용자가 동일한 이메일을 사용하는 소셜 계정으로 로그인할 때, 기존 계정과 자동으로 연동된다.

**Why this priority**: 사용자 경험 개선 및 중복 계정 방지를 위해 필요하지만, 기본 소셜 로그인 이후 구현

**Independent Test**: 이메일로 가입된 계정이 있는 상태에서 동일 이메일의 소셜 로그인 시도 → 기존 계정에 소셜 계정 연동 확인

**Acceptance Scenarios**:

1. **Given** user@example.com으로 이메일 가입된 사용자, **When** 동일 이메일의 카카오 계정으로 소셜 로그인하면, **Then** 기존 계정에 카카오 계정이 연동되고 로그인된다
2. **Given** 이미 카카오가 연동된 계정, **When** 다른 소셜 계정(구글)으로 로그인하면, **Then** 해당 소셜 계정도 추가로 연동된다

---

### Edge Cases

- 소셜 제공자의 서버 오류 시 적절한 에러 메시지를 표시하고 재시도를 안내한다
- 사용자가 소셜 제공자에서 이메일 권한을 거부할 경우 이메일 없이는 가입이 불가하다는 메시지를 표시한다
- 소셜 제공자에서 동일 이메일이지만 다른 사용자 ID로 인증된 경우 보안상 새 계정으로 처리한다
- OAuth 콜백 URL이 유효하지 않거나 state 검증 실패 시 인증을 거부한다
- 토큰 갱신 중 소셜 제공자 토큰이 만료된 경우 재인증을 요청한다

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 시스템은 카카오 OAuth2.0 인증을 통해 사용자 로그인을 지원해야 한다
- **FR-002**: 시스템은 구글 OAuth2.0 인증을 통해 사용자 로그인을 지원해야 한다
- **FR-003**: 시스템은 네이버 OAuth2.0 인증을 통해 사용자 로그인을 지원해야 한다
- **FR-004**: 시스템은 OAuth 인증 시작을 위한 Authorization URL을 생성해야 한다
- **FR-005**: 시스템은 OAuth 콜백에서 authorization code를 access token으로 교환해야 한다
- **FR-006**: 시스템은 소셜 제공자로부터 사용자 정보(이메일, 이름, 프로필 이미지)를 조회해야 한다
- **FR-007**: 신규 소셜 로그인 시 시스템은 새 사용자 계정을 자동 생성해야 한다
- **FR-008**: 기존 사용자의 소셜 로그인 시 시스템은 기존 계정으로 인증해야 한다
- **FR-009**: 시스템은 소셜 계정 정보를 별도 테이블에 저장하여 관리해야 한다
- **FR-010**: 시스템은 동일 이메일의 기존 계정이 있을 경우 소셜 계정을 연동해야 한다
- **FR-011**: 시스템은 OAuth state 파라미터를 검증하여 CSRF 공격을 방지해야 한다
- **FR-012**: 시스템은 소셜 로그인 성공 시 기존 이메일 로그인과 동일한 JWT 토큰(Access + Refresh)을 발급해야 한다

### Key Entities

- **OAuthAccount**: 사용자와 연결된 소셜 계정 정보 (제공자, 제공자 사용자 ID, 이메일, 액세스 토큰, 리프레시 토큰, 연동 일시)
- **User**: 기존 사용자 엔티티와 1:N 관계 (한 사용자가 여러 소셜 계정을 연동할 수 있음)

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 사용자는 3번의 클릭(로그인 버튼 → 제공자 선택 → 제공자 인증) 이내에 소셜 로그인을 완료할 수 있다
- **SC-002**: 소셜 로그인 전체 과정은 제공자 인증 시간 제외 5초 이내에 완료된다
- **SC-003**: 신규 소셜 로그인 사용자의 90% 이상이 추가 정보 입력 없이 서비스 이용을 시작할 수 있다
- **SC-004**: 소셜 로그인 관련 오류 발생 시 100%의 경우에 사용자에게 이해 가능한 메시지가 표시된다

## Assumptions

- 각 소셜 제공자(카카오, 구글, 네이버)의 개발자 계정 및 OAuth 앱이 사전에 등록되어 있다
- 소셜 제공자로부터 이메일 정보를 필수로 받아올 수 있다 (이메일 권한 필수 요청)
- SPEC-001에서 구현된 JWT 토큰 발급 및 세션 관리 로직을 재사용한다
- 프론트엔드에서 OAuth 콜백을 처리하고 백엔드 API를 호출하는 구조를 사용한다
