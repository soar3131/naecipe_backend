# Feature Specification: 사용자 프로필 및 취향 설정

**Feature Branch**: `003-user-profile-preferences`
**Created**: 2025-12-10
**Status**: Draft
**Input**: User description: "SPEC-003: 사용자 프로필 및 취향 설정 - 프로필 조회/수정, 식이 제한/알레르기 설정, 맛 취향 프로파일"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 프로필 조회 (Priority: P1)

로그인한 사용자가 자신의 프로필 정보(이름, 프로필 이미지 등)를 조회한다. 모든 사용자 관련 화면의 기본이 되는 기능이다.

**Why this priority**: 프로필 조회는 사용자 설정 화면의 기본 기능이며, 수정 기능의 전제 조건이다.

**Independent Test**: 로그인 후 프로필 조회 API를 호출하면 현재 사용자의 프로필 정보가 반환된다.

**Acceptance Scenarios**:

1. **Given** 로그인된 사용자, **When** 프로필 조회 요청을 보내면, **Then** 사용자 이름, 이메일, 프로필 이미지 URL이 포함된 응답을 받는다
2. **Given** 유효하지 않은 토큰, **When** 프로필 조회 요청을 보내면, **Then** 인증 오류 응답을 받는다
3. **Given** 프로필 이미지가 없는 사용자, **When** 프로필 조회 요청을 보내면, **Then** 프로필 이미지 필드는 null이거나 기본 이미지 URL을 반환한다

---

### User Story 2 - 프로필 수정 (Priority: P1)

사용자가 자신의 이름과 프로필 이미지를 변경한다. 개인화된 경험을 위한 필수 기능이다.

**Why this priority**: 사용자가 자신을 식별하는 기본 정보를 관리할 수 있어야 한다.

**Independent Test**: 프로필 수정 API를 호출하면 변경된 정보가 저장되고, 이후 조회 시 변경된 값이 반환된다.

**Acceptance Scenarios**:

1. **Given** 로그인된 사용자, **When** 새로운 이름으로 프로필 수정 요청을 보내면, **Then** 성공 응답을 받고 이름이 변경된다
2. **Given** 로그인된 사용자, **When** 새로운 프로필 이미지 URL로 수정 요청을 보내면, **Then** 성공 응답을 받고 프로필 이미지가 변경된다
3. **Given** 빈 이름으로 수정 요청, **When** 요청을 보내면, **Then** 유효성 검사 오류 응답을 받는다
4. **Given** 이름이 최대 길이(50자)를 초과, **When** 수정 요청을 보내면, **Then** 유효성 검사 오류 응답을 받는다

---

### User Story 3 - 식이 제한 및 알레르기 설정 (Priority: P1)

사용자가 자신의 식이 제한(채식, 비건 등)과 알레르기 정보(땅콩, 갑각류 등)를 설정한다. AI 보정 시 안전한 레시피 추천을 위해 필수적이다.

**Why this priority**: Core Loop의 AI 보정 기능에서 사용자 안전과 직결된 정보로, 잘못된 재료 추천을 방지한다.

**Independent Test**: 알레르기 정보를 설정하면 저장되고, 이후 조회 시 설정된 값이 반환된다.

**Acceptance Scenarios**:

1. **Given** 로그인된 사용자, **When** 식이 제한(예: vegetarian)을 설정하면, **Then** 성공 응답을 받고 해당 정보가 저장된다
2. **Given** 로그인된 사용자, **When** 알레르기 목록(예: peanut, shellfish)을 설정하면, **Then** 성공 응답을 받고 해당 정보가 저장된다
3. **Given** 기존 알레르기가 설정된 사용자, **When** 새로운 알레르기 목록으로 업데이트하면, **Then** 기존 목록이 새 목록으로 대체된다
4. **Given** 빈 알레르기 목록으로 요청, **When** 업데이트하면, **Then** 기존 알레르기 설정이 모두 제거된다

---

### User Story 4 - 맛 취향 프로파일 설정 (Priority: P2)

사용자가 단맛, 짠맛, 매운맛, 신맛 등의 선호도를 설정한다. AI 레시피 보정 시 개인화된 조정을 위해 사용된다.

**Why this priority**: Core Loop의 AI 보정 품질을 높이는 기능이나, 알레르기/식이제한보다 우선순위가 낮다(안전 vs 선호).

**Independent Test**: 맛 취향 값을 설정하면 저장되고, 이후 조회 시 설정된 값이 반환된다.

**Acceptance Scenarios**:

1. **Given** 로그인된 사용자, **When** 전체(overall) 맛 취향(sweetness: 3, saltiness: 4, spiciness: 5, sourness: 2)을 설정하면, **Then** 성공 응답을 받고 저장된다
2. **Given** 로그인된 사용자, **When** 요리 카테고리별(예: korean) 맛 취향을 설정하면, **Then** 해당 카테고리에 대한 취향이 저장된다
3. **Given** 취향 값이 허용 범위(1-5)를 벗어남, **When** 설정 요청을 보내면, **Then** 유효성 검사 오류 응답을 받는다
4. **Given** 일부 취향 값만 제공, **When** 설정 요청을 보내면, **Then** 제공된 값만 업데이트되고 나머지는 기존 값 유지

---

### User Story 5 - 기타 취향 정보 설정 (Priority: P3)

사용자가 요리 실력 수준, 가구 인원 수, 선호하는 요리 카테고리 등 부가 정보를 설정한다.

**Why this priority**: 레시피 추천 개인화에 도움이 되지만, 핵심 Core Loop 동작에는 필수적이지 않다.

**Independent Test**: 부가 취향 정보를 설정하면 저장되고, 조회 시 반환된다.

**Acceptance Scenarios**:

1. **Given** 로그인된 사용자, **When** 요리 실력 수준(1-5)을 설정하면, **Then** 성공 응답을 받고 저장된다
2. **Given** 로그인된 사용자, **When** 가구 인원 수를 설정하면, **Then** 성공 응답을 받고 저장된다
3. **Given** 로그인된 사용자, **When** 선호 요리 카테고리(예: korean, japanese)를 설정하면, **Then** 성공 응답을 받고 저장된다

---

### Edge Cases

- 동시에 여러 기기에서 프로필을 수정할 경우 마지막 요청이 반영된다 (Last-Write-Wins)
- 허용되지 않는 식이 제한 또는 알레르기 값 입력 시 유효성 검사 오류를 반환한다
- 프로필 이미지 URL이 유효하지 않은 형식일 경우 저장은 허용하되, 이미지 로드 실패는 클라이언트가 처리한다
- 취향 설정이 한 번도 되지 않은 신규 사용자 조회 시 기본값 또는 빈 값을 반환한다

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 시스템은 인증된 사용자가 자신의 프로필 정보를 조회할 수 있어야 한다
- **FR-002**: 시스템은 인증된 사용자가 자신의 이름과 프로필 이미지를 수정할 수 있어야 한다
- **FR-003**: 이름은 1자 이상 50자 이하로 제한되어야 한다
- **FR-004**: 시스템은 인증된 사용자가 식이 제한 목록을 설정/조회/수정할 수 있어야 한다
- **FR-005**: 시스템은 인증된 사용자가 알레르기 목록을 설정/조회/수정할 수 있어야 한다
- **FR-006**: 식이 제한 및 알레르기는 미리 정의된 값 목록에서만 선택 가능해야 한다
- **FR-007**: 시스템은 인증된 사용자가 맛 취향 프로파일(단맛, 짠맛, 매운맛, 신맛)을 설정할 수 있어야 한다
- **FR-008**: 맛 취향 값은 1(매우 약함)부터 5(매우 강함)까지의 정수로 제한되어야 한다
- **FR-009**: 시스템은 전체(overall) 취향과 요리 카테고리별 취향을 별도로 관리해야 한다
- **FR-010**: 시스템은 요리 실력 수준(1-5)을 설정할 수 있어야 한다
- **FR-011**: 시스템은 가구 인원 수를 설정할 수 있어야 한다
- **FR-012**: 시스템은 선호하는 요리 카테고리 목록을 설정할 수 있어야 한다
- **FR-013**: 모든 취향 설정은 선택 사항이며, 설정하지 않은 경우에도 서비스 이용에 지장이 없어야 한다

### Key Entities

- **UserProfile**: 사용자의 기본 프로필 정보. 사용자 ID(외래키), 표시 이름, 프로필 이미지 URL, 식이 제한 목록, 알레르기 목록, 요리 실력 수준, 가구 인원 수, 선호 요리 카테고리 목록 포함. User 엔티티와 1:1 관계
- **TastePreference**: 사용자의 맛 취향 프로파일. 사용자 ID(외래키), 카테고리(overall 또는 특정 요리 카테고리), 단맛/짠맛/매운맛/신맛 수치 포함. User와 1:N 관계 (카테고리별 별도 레코드)

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 사용자는 프로필 정보를 1초 이내에 조회할 수 있다
- **SC-002**: 사용자는 프로필 수정을 2초 이내에 완료할 수 있다
- **SC-003**: 취향 설정 API는 1초 이내에 응답해야 한다
- **SC-004**: 시스템은 500명의 동시 프로필 조회/수정 요청을 처리할 수 있다
- **SC-005**: 95% 이상의 사용자가 추가 도움 없이 취향 설정을 완료할 수 있다
- **SC-006**: 알레르기 정보 설정 후 AI 보정 시 해당 재료가 추천되지 않아야 한다

## Assumptions

- SPEC-001에서 구현된 사용자 인증(JWT) 시스템을 사용한다
- 프로필 이미지 파일 업로드는 별도 서비스(CDN/스토리지)에서 처리하며, 이 스펙에서는 URL만 저장한다
- 식이 제한 및 알레르기의 허용값 목록은 시스템에서 미리 정의한다
- 맛 취향 정보는 AI Agent Service에서 레시피 보정 시 참조된다 (SPEC-011)
- 사용자 계정 생성 시 UserProfile은 자동으로 생성되며 기본값으로 초기화된다

## Scope Boundaries

### 포함 (In Scope)

- 프로필 조회 API (GET /users/me)
- 프로필 수정 API (PUT /users/me)
- 취향 설정 API (PUT /users/me/preferences)
- 식이 제한/알레르기 목록 관리
- 맛 취향 프로파일 관리 (overall 및 카테고리별)
- 요리 실력 수준, 가구 인원, 선호 요리 카테고리 관리
- UserProfile, TastePreference 엔티티 및 테이블

### 제외 (Out of Scope)

- 이메일 변경 (보안상 별도 스펙에서 다룸)
- 비밀번호 변경/재설정 (별도 스펙)
- 프로필 이미지 파일 업로드 (별도 스토리지 서비스)
- 회원 탈퇴 (별도 스펙)
- 다른 사용자 프로필 조회 (Phase 1에서 커뮤니티 기능 미포함)
- 피드백 기반 취향 자동 학습 (SPEC-009 이후 별도 스펙)
- 프로필 공개/비공개 설정

## Predefined Values

### 식이 제한 (Dietary Restrictions)

- `vegetarian`: 채식 (유제품/계란 허용)
- `vegan`: 비건 (동물성 제품 불가)
- `pescatarian`: 페스코 (해산물 허용)
- `halal`: 할랄
- `kosher`: 코셔
- `gluten_free`: 글루텐 프리
- `lactose_free`: 유당 불내증
- `low_sodium`: 저염식
- `low_sugar`: 저당식

### 알레르기 (Allergies)

- `peanut`: 땅콩
- `tree_nut`: 견과류
- `milk`: 우유
- `egg`: 달걀
- `wheat`: 밀
- `soy`: 대두
- `fish`: 생선
- `shellfish`: 갑각류/조개류
- `sesame`: 참깨

### 요리 카테고리 (Cuisine Categories)

- `korean`: 한식
- `japanese`: 일식
- `chinese`: 중식
- `western`: 양식
- `italian`: 이탈리안
- `mexican`: 멕시칸
- `thai`: 태국
- `vietnamese`: 베트남
- `indian`: 인도
- `fusion`: 퓨전
