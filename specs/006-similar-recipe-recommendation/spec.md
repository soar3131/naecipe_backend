# Feature Specification: 유사 레시피 추천

**Feature Branch**: `006-similar-recipe-recommendation`
**Created**: 2025-12-11
**Status**: Draft
**Input**: SPEC-006: 유사 레시피 추천 - 콘텐츠 기반 유사 레시피, 태그 기반 관련 레시피, 같은 카테고리 내 인기 레시피, 같은 요리사의 다른 레시피 추천

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 유사 레시피 조회 (Priority: P1)

사용자가 특정 원본 레시피의 상세 페이지를 보고 있을 때, 해당 레시피와 유사한 다른 레시피 목록을 확인할 수 있다. 이를 통해 사용자는 비슷한 요리를 탐색하고 대안을 발견할 수 있다.

**Why this priority**: 유사 레시피 추천은 Core Loop에서 사용자 체류 시간과 레시피 탐색 깊이를 증가시키는 핵심 기능이다. 사용자가 관심 있는 레시피를 발견했을 때 관련 레시피를 쉽게 탐색할 수 있도록 하여 서비스 가치를 높인다.

**Independent Test**: 특정 레시피 ID로 API를 호출하면 재료, 조리법, 태그 유사도 기반으로 정렬된 유사 레시피 목록을 반환한다.

**Acceptance Scenarios**:

1. **Given** 사용자가 김치찌개 레시피(ID: A)를 보고 있을 때, **When** 유사 레시피 API를 호출하면, **Then** 김치찌개와 유사한 레시피 목록(된장찌개, 부대찌개 등)이 유사도 순으로 반환된다.
2. **Given** 레시피(ID: A)가 태그 [한식, 찌개, 매운맛]을 가지고 있을 때, **When** 유사 레시피 조회 시, **Then** 같은 태그를 많이 공유하는 레시피가 높은 유사도를 보인다.
3. **Given** 유사 레시피 목록이 반환될 때, **When** 각 레시피를 확인하면, **Then** 썸네일, 제목, 조리시간, 난이도, 유사도 점수가 포함되어 있다.

---

### User Story 2 - 같은 요리사의 다른 레시피 조회 (Priority: P2)

사용자가 특정 요리사(셰프, 인플루언서)의 레시피를 보고 있을 때, 해당 요리사가 만든 다른 레시피 목록을 확인할 수 있다. 이를 통해 사용자는 마음에 드는 요리사의 콘텐츠를 더 탐색할 수 있다.

**Why this priority**: 요리사 기반 추천은 사용자 충성도와 콘텐츠 소비를 증가시킨다. 특정 요리사의 스타일을 좋아하는 사용자가 해당 요리사의 다른 레시피를 쉽게 발견할 수 있다.

**Independent Test**: 특정 레시피의 요리사 ID로 해당 요리사의 다른 레시피 목록을 조회할 수 있다.

**Acceptance Scenarios**:

1. **Given** 백종원 셰프의 김치찌개 레시피를 보고 있을 때, **When** 같은 요리사 레시피 API를 호출하면, **Then** 백종원 셰프의 다른 레시피 목록이 반환된다(현재 보고 있는 레시피 제외).
2. **Given** 요리사가 10개의 레시피를 가지고 있을 때, **When** 같은 요리사 레시피 조회 시, **Then** 최근 등록순 또는 인기순으로 정렬된 목록이 반환된다.
3. **Given** 요리사가 1개의 레시피만 가지고 있을 때, **When** 같은 요리사 레시피 조회 시, **Then** 빈 목록이 반환된다(현재 레시피 제외).

---

### User Story 3 - 태그 기반 관련 레시피 조회 (Priority: P2)

사용자가 특정 레시피를 보고 있을 때, 해당 레시피의 태그를 기반으로 관련된 레시피 목록을 확인할 수 있다. 이를 통해 사용자는 같은 카테고리나 요리 스타일의 레시피를 탐색할 수 있다.

**Why this priority**: 태그 기반 추천은 구현이 단순하면서도 효과적인 추천 방식이다. 사용자가 특정 요리 카테고리에 관심이 있을 때 해당 카테고리의 다른 레시피를 쉽게 발견할 수 있다.

**Independent Test**: 특정 레시피의 태그를 기반으로 동일 태그를 가진 다른 레시피 목록을 조회할 수 있다.

**Acceptance Scenarios**:

1. **Given** 레시피가 [한식, 찌개, 매운맛] 태그를 가지고 있을 때, **When** 태그 기반 관련 레시피 조회 시, **Then** 같은 태그를 많이 공유하는 레시피가 반환된다.
2. **Given** 태그 겹침 정도가 다른 여러 레시피가 있을 때, **When** 관련 레시피 조회 시, **Then** 태그 겹침 수가 많은 레시피가 먼저 반환된다.
3. **Given** 현재 레시피와 동일한 태그를 가진 레시피가 없을 때, **When** 태그 기반 관련 레시피 조회 시, **Then** 빈 목록 또는 부분적으로 겹치는 레시피가 반환된다.

---

### User Story 4 - 같은 카테고리 내 인기 레시피 조회 (Priority: P3)

사용자가 특정 카테고리(예: 한식, 양식)의 레시피를 보고 있을 때, 해당 카테고리 내에서 가장 인기 있는 레시피 목록을 확인할 수 있다.

**Why this priority**: 카테고리 기반 인기 레시피는 사용자가 해당 분야의 베스트 콘텐츠를 발견할 수 있게 해주는 부가 기능이다. 유사 레시피와 태그 기반 추천이 우선이다.

**Independent Test**: 특정 레시피의 카테고리를 기반으로 해당 카테고리 내 인기 레시피 목록을 조회할 수 있다.

**Acceptance Scenarios**:

1. **Given** 한식 카테고리의 레시피를 보고 있을 때, **When** 카테고리 인기 레시피 조회 시, **Then** 한식 카테고리 내 exposure_score 또는 view_count 기준 상위 레시피가 반환된다.
2. **Given** 인기 레시피 목록이 반환될 때, **When** 목록을 확인하면, **Then** 현재 보고 있는 레시피는 제외되어 있다.
3. **Given** 카테고리 내 레시피가 충분히 있을 때, **When** 인기 레시피 조회 시, **Then** 기본 10개 레시피가 반환되고 페이지네이션이 지원된다.

---

### Edge Cases

- 레시피에 태그가 없는 경우: 재료 기반 유사도만 계산하여 유사 레시피를 반환한다.
- 요리사 정보가 없는 레시피: 같은 요리사 레시피 조회 시 빈 목록을 반환한다.
- 유사 레시피가 임계치 미만인 경우: 유사도가 낮더라도 존재하는 레시피를 반환하되 유사도 점수를 함께 표시한다.
- 비활성화된 레시피(is_active=false): 모든 추천 목록에서 제외한다.
- 동시 다중 요청: 캐싱을 통해 성능을 보장한다.

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 시스템은 특정 레시피와 유사한 레시피 목록을 반환해야 한다 (`GET /recipes/:id/similar`).
- **FR-002**: 유사도 계산 시 재료 유사도(재료명 겹침)를 고려해야 한다.
- **FR-003**: 유사도 계산 시 태그 유사도(태그 겹침)를 고려해야 한다.
- **FR-004**: 유사도 계산 시 조리법 유사도(난이도, 조리시간 근접성)를 고려해야 한다.
- **FR-005**: 시스템은 같은 요리사의 다른 레시피 목록을 반환해야 한다 (`GET /recipes/:id/same-chef`).
- **FR-006**: 같은 요리사 레시피 조회 시 현재 레시피는 목록에서 제외해야 한다.
- **FR-007**: 같은 요리사 레시피는 최신순 또는 인기순으로 정렬되어야 한다.
- **FR-008**: 모든 추천 결과에서 비활성화된 레시피(is_active=false)는 제외해야 한다.
- **FR-009**: 추천 결과는 커서 기반 페이지네이션을 지원해야 한다.
- **FR-010**: 추천 결과에는 레시피 기본 정보(id, 제목, 썸네일, 조리시간, 난이도)가 포함되어야 한다.
- **FR-011**: 유사 레시피 결과에는 유사도 점수(0~1)가 포함되어야 한다.
- **FR-012**: 추천 결과는 Redis에 캐싱하여 반복 요청 성능을 최적화해야 한다.
- **FR-013**: 추천 결과 캐시 TTL은 10분으로 설정해야 한다.
- **FR-014**: 레시피당 기본 추천 레시피 수는 10개로 제한해야 한다.

### Key Entities

- **유사 레시피 결과(Similar Recipe Result)**: 유사 레시피 ID, 유사도 점수(0~1), 유사도 타입(재료/태그/조리법), 레시피 기본 정보 포함
- **요리사(Chef)**: 레시피를 만든 원작자. SPEC-004에서 정의된 chefs 테이블 사용
- **태그(Tag)**: 레시피에 부여된 분류 태그. SPEC-004에서 정의된 tags, recipe_tags 테이블 사용
- **재료(Ingredient)**: 레시피의 재료 정보. SPEC-004에서 정의된 recipe_ingredients 테이블 사용

### Assumptions

- SPEC-004(원본 레시피 기본 CRUD)가 완료되어 chefs, recipes, recipe_ingredients, tags, recipe_tags 테이블이 존재한다.
- SPEC-005(원본 레시피 검색)가 완료되어 기본 검색 인프라가 구축되어 있다.
- Knowledge 모듈의 벡터 유사도 검색은 Phase 2에서 구현되므로, 현재는 SQL 기반 유사도 계산을 사용한다.
- 카테고리는 태그 중 category가 'cuisine' 또는 'type'인 태그로 판단한다.

### Dependencies

- **SPEC-004**: chefs, recipes, recipe_ingredients, tags, recipe_tags 테이블 필요
- **SPEC-005**: 검색 인프라 및 캐싱 패턴 참조
- **Knowledge 모듈**: 향후 벡터 유사도 검색 통합 예정 (SPEC-013 완료 후)

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 유사 레시피 API 응답 시간이 평균 300ms 이내여야 한다 (캐시 히트 시 50ms 이내).
- **SC-002**: 유사 레시피 결과의 80% 이상이 원본 레시피와 1개 이상의 태그를 공유해야 한다.
- **SC-003**: 같은 요리사 레시피 API는 요리사당 레시피가 100개 이하일 때 100ms 이내에 응답해야 한다.
- **SC-004**: 추천 기능을 통해 레시피 상세 페이지에서 다른 레시피로의 전환율이 20% 이상이어야 한다 (향후 Analytics로 측정).
- **SC-005**: 캐시 히트율이 70% 이상이어야 한다 (자주 조회되는 인기 레시피 기준).
- **SC-006**: 동시 1000명 사용자가 유사 레시피를 조회해도 응답 시간 저하 없이 서비스되어야 한다.
